#!/usr/bin/env python3
import copy
import os

def combinations(list_of_choices):
    combos = [[choice] for choice in list_of_choices[0]]
    for choices in list_of_choices[1:]:
        new_combos = []
        for choice in choices:
            new_combos += copy.deepcopy(combos)
            for i in range(len(combos)):
                new_combos[-i-1].append(choice)
    
        combos = new_combos
    return combos

combos = combinations([
    [(1,5), (5, 20), (5, 40), (5, 60), (10, 80)],
    [300, 999],
    [500, 1000],
    [.001, .002, .006, .01, .02, .06],
])

import random
random.shuffle(combos)


html = open("out/out.html", "w")
html.write("""
<!doctype html>
<html>
<head>
<title>Evo Results</title>
</head>
<body>
<p>Seed: 2</p>
<table border="1">
<tr>
    <th>gen_size</th>
    <th>surv_count</th>
    <th>init_prg_size</th>
    <th>cycle_count</th>
    <th>mut_chance</th>
    <th>Graph</th>
    <th>Best program source</th>
    <th>Best program output</th>
    <th>Best program score</th>
    <th>Best program cycle count</th>
</tr>
""")
html.close()

print("%i combinations" % len(combos))
for (surv_count, gen_size), init_prg_size, cycle_count, mut_chance in combos:
    args = (
        ('goal', 'tst/hello.stdout'),
        ('seed', '2'),
        ('generationlimit', '9999'),
        ('gen_size', gen_size),
        ('surv_count', surv_count),
        ('init_prg_size', init_prg_size),
        ('cycle_count', cycle_count),
        ('mut_chance', mut_chance),
    )
    argstr = ' '.join(['--%s %s' % arg for arg in args])

    evocmd = "build/debug/evo %s hi >log" % argstr
    plotcmd = "bin/plot log"

    print(evocmd)
    os.system(evocmd)
    print(plotcmd)
    os.system(plotcmd)


html = open("out/out.html", "a")
html.write("""
</table>
</body>
</html>
""")
html.close()
